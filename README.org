#+TITLE: beego-auth
#+SETUPFILE: ~/s3sync/org/conf/setup.config
#+FILETAGS: :golang:authentication:beego:web

The main goal of this project is to develop a small /stand-alone/ user login for
the [[https://beego.me/][Beego Framework]] by [[https://github.com/astaxie][astaxie]]. This work is mainly a
continuation of the [[https://github.com/horrido/acme][beego-acme]] example presented in the article "[[https://richardeng.medium.com/a-word-from-the-beegoist-d562ff8589d7][A Word From The
Beegoist]]" (2014, [[https://github.com/horrido][Richard Eng]]).

* Further Topics
- Beego integration of Vault utilizing [[https://github.com/mittwald/vaultgo][vaultgo]] package by [[https://github.com/mittwald][Mittwald CM Service]].
- Mail client provided by official [[https://github.com/sendgrid/sendgrid-go][Twilio/Sendgrid]] service.

* Prerequisites
- Beego v2.0.2
- Go 1.16.x

* Getting Started
** Run Main
- Run =beego-auth=
#+begin_src bash
$ source .beego.env
$ go build
$ ./beego-auth
#+end_src

* Commands
#+begin_src bash
# rebuild database (all prior data lost!)
./beego-auth orm syncdb -h
./beego-auth orm syncdb -db "auth" -force=true -v=true
#+end_src

* Testing
#+begin_src bash
go test ./conf -v
go test ./pkg/vaultv1 -v
#+end_src

* General Instructions
** Beego Config
- loaded by default [[file:vendor/github.com/beego/beego/v2/core/config/ini.go::func init() {][beego/beego/v2/core/config/ini.go]]
- may lead to /[W]/ (Beego Warning):
#+begin_src bash
2021/12/01 12:09:06.965 [W]  init global config instance failed. If you donot
use this, just ignore it.  open conf/app.conf: no such file or directory
#+end_src

- work-around by providing empty =app.conf= with /include./

** Create Vault Transit Key
- [[https://support.hashicorp.com/hc/en-us/articles/4404333857811-How-to-manually-decrypt-transit-data][https://support.hashicorp.com/hc/en-us/articles/4404333857811-How-to-manually-decrypt-transit-data]]
#+begin_src bash
$ vault secrets enable transit
$ vault write -f transit/keys/beego-key
$ vault list transit/keys
$ vault read transit/keys/beego-key

# decrypt data previously encrypted by Vault Transit
$ mage decrypt vault:v1:oZTuFdqpTReBPCV/qHj3itmTa86tybxHBUQxR6Xx3k7IQ0h3DcX6a7s=
#+end_src

* Where to go from here?
..

* Credits
- Thanks to [[https://github.com/horrido][Richard Eng]].
- Thanks to [[https://github.com/mittwald][Mittwald CM Service]].
